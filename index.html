<html>

<style>
    body {
        background-color: cornsilk
    }

    input {
        width: 50%
    }
</style>

<body>
    <pre>
    

        Private Key:<input id="pKey" value="0x0123456789012345678901234567890123456789012345678901234567890123">
        contractAddress:<input id="contractAddress" value="0x0dcd2f752394c41875e259e00bb44fd505297caf">
        wei:<input id="wei" value="1000000000000000000">
        <button onclick="sign()">sign</button>
        <div id="sign"></div>
            
        <div id="signedMsg"></div>

        <button onclick="send()" id="sendBtn" style="visibility:hidden;">send</button>

        
    </pre>
</body>


<!-- // https://github.com/axios/axios -->
<script src="./js/axios.max.js"></script>
<!-- https://github.com/ethers-io/ethers.js/#installing -->
<script src="./js/ethers.max.js"></script>
<script>

    function sign() {
        const wei = document.getElementById('wei').value
        const contractAddress = document.getElementById('contractAddress').value
        const privateKey = document.getElementById('pKey').value

        const signingKey = new ethers.SigningKey(privateKey);
        const address = signingKey.address
        console.log(address)

        // https://docs.ethers.io/ethers.js/html/api-utils.html?highlight=keccak256
        const h = ethers.utils.solidityKeccak256(['address', 'uint'], [contractAddress, ethers.utils.bigNumberify(wei)]);

        // sign and split message: https://github.com/ethers-io/ethers.js/issues/85
        const { r, s, recoveryParam } = signingKey.signDigest(h);
        const v = 27 + recoveryParam

        document.getElementById('signedMsg').innerHTML = JSON.stringify({ h, v, r, s, contractAddress, wei }, null, 4)
        document.getElementById('sendBtn').style.visibility = "visible"
    }

    async function send() {
        // get object from dom
        const signedMsg = JSON.parse(document.getElementById('signedMsg').textContent)
        // POST signed msg
        const response = await axios({
            method: 'POST',
            url: 'http://localhost:8000/send',
            data: signedMsg
        })

        console.log(response)
    }

</script>

</html>